services:
  disrust:
    build: .
    security_opt:
      - seccomp:unconfined
    ports:
      - "9900:9900"
    cpuset: "0,1"     # pin: IO thread + batch processor, both busy-spin
    deploy:
      resources:
        reservations:
          cpus: "2"
          memory: 512m
        limits:
          cpus: "2"
          memory: 512m

  client:
    build: .
    network_mode: "service:disrust"
    depends_on:
      - disrust
    profiles:
      - client
    command: ["client"]
    cpuset: "2,3"     # non-overlapping with server (adjust to VM CPU count)
    deploy:
      resources:
        reservations:
          cpus: "2"
          memory: 256m
        limits:
          cpus: "2"
          memory: 256m
